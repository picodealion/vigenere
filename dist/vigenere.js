function fragmentedFor(n){var t,e,r,o,i,c=function(){t=n.fragmentLength||10,e=n.totalLoops,r=n.runEachLoop,o=n.runWhenDone,i=n.start||0,u()},u=function(){for(var n=i+t,e=$lStart;e<Math.min(n,a());e++)r(e);i+=t,i<a()?setTimeout(u,1):o()},a=function(){return f(e)?e():e},f=function(n){return"function"==typeof n};c()}function fragmentedForAsync(n,t,e,r){!function o(){t>n?e(n++,o):r()}()}function confirmKeyLengthFriedman(n,t){var e,r=.067,o=[],i=n,c=t,u=function(){log("Step 2: Test possible keylengths using Friedman method",!0),a(),p(),F()},a=function(){$.each(c,function(n,t){log("Checking Index of Coincidence for key with length "+t,!0);var e=f(t);m(t,e)})},f=function(n){var t=l(n);return s(t)},l=function(n){for(var t=[],e=0;n>e;e++){var r=g(n,e);t.push(r)}return t},g=function(n,t){for(var e=t,r="";i[e];)r+=i[e],e+=n;return r},s=function(n){console.log("getDeltaBarIC ",n);var t=[];return $.each(n,function(n,e){t[n]=h(e)}),$lDeltaBar=v(t),log(": "+$lDeltaBar),$lDeltaBar},h=function(n){for(var t=0,e=0,r=d(26),o=0;o<n.length;o++)r[n.charCodeAt(o)-97]++,t++;for(var i=0;26>i;i++)e+=r[i]*(r[i]-1);var c=e/(t*(t-1));return c},d=function(n){for(var t=[],e=0;n>e;e++)t[e]=0;return t},v=function(n){var t=0;return $.each(n,function(n,e){t+=e}),t/n.length},m=function(n,t){o.push([n,t])},p=function(){var n={};$.each(o,function(t,e){n[e[0]]=Math.abs(e[1]-r)});var t=y(n),i=sortObjectByValue(t,!1);e=i[0][0]},y=function(n){for(var t=objectToArray(n),e=1;e<t.length;e++)for(var r=0;e>r;r++){var o=t[e],i=t[r],c=o[0]%i[0]===0,u=Math.abs(o[1]/i[1]-1);c&&.1>u&&delete n[o[0]]}return n},F=function(n,t){log("Best guess for keylength: "+e,!0),$(document).trigger("FriedmanEnded",e)};u()}function defineKeyLengthKasiski(n,t,e){var r,o,i,c,u,a=function(){log("Step 1: Define key length using Kasiski method",!0),c=[],r=n,i=t,o=e-i,fragmentedForAsync(0,o,f,s)},f=function(n,t){$lCurrentStringLength=e-n,l($lCurrentStringLength,function(n){c=c.concat(n),t()})},l=function(n,t){log("Finding recurring strings of length "+n,!0),u=n;var e=t,o=[];fragmentedFor(10,h,function(n){var t=r.substr(n,u);o=g(t,o),log(".")},function(){e(o)})},g=function(n,t){if(n.indexOf(" ")>-1)return t;var e=new RegExp(n,"g"),o=r.match(e),i=o.length;return i>1&&(r=r.replace(e," "),t.push(n),log(n+" occurs "+i+" time(s)",!0)),t},s=function(){if(!(c.length>0))return log("No recurring strings found :(. Either the key is too long or the ciphertext is too short to break the code.",!0),!1;log("Recurring strings:"+c,!0),log("Distances between recurring strings: ",!0);var n=[];$.each(c,function(t,e){n=n.concat(d(e))}),log(n);var t=v(n);y(t)},h=function(){return r.length-u},d=function(t){for(var e=[],r=n.split(t),o=1;o<r.length-1;o++)$lDist=r[o].length+t.length,e.push($lDist);return e},v=function(n){console.log(n);var t=[];$.each(n,function(n,e){-1===$.inArray(e,t)&&t.push(e)});for(var e=[],r=0;r<t.length-1;r++)e.push(m(t[r],t[r+1]));var o=p(e),i=sortObjectByValue(o,!0),c=[];return $.each(i,function(n,t){return c.push(parseInt(t[0])),c.length>2?!1:void 0}),c},m=function(n,t){for(var e=Math.min(n,t),r=Math.max(n,t);e>=i;){var o=e;e=r%e,r=o}return r},p=function(n){var t={};return $.each(n,function(n,e){t[e]=(t[e]||0)+1}),t},y=function(n){log("Most probable key lengths: ",!0),log(n),$(document).trigger("KasiskiEnded",[n])};a()}function Decipher(){var n,t=3,e=12,r=function(){$("#log").html(""),n=normalize($("#ciphertext").val()),o(),i()},o=function(){$(document).off("KasiskiEnded").on("KasiskiEnded",function(t,e){log("Finished step 1",!0),confirmKeyLengthFriedman(n,e)}),$(document).off("FriedmanEnded").on("FriedmanEnded",function(n,t){log("Finished step 2",!0),console.log("all done (for now)")})},i=function(){log("Starting to decipher"),defineKeyLengthKasiski(n,t,e)};r()}function fragmentedForAsync(n,t,e,r){!function o(){t>n?e(n++,o):r()}()}function objectToArray(n){var t=[];return $.each(n,function(n,e){parseInt(n)==n&&(n=parseInt(n)),t.push([n,e])}),t}function arrayToObject(n){var t={};return $.each(n,function(n,e){t[e[0]]=e[1]}),t}var fragmentedFor=function(n,t,e,r){var o=0,i=function(){};i(),function c(t){for(var u=o+n,a=o;a<Math.min(u,i());a++)e(a);o+=n,o<i()?setTimeout(c,1):r()}()};$(document).ready(function(){$("#decipher").click(function(){$solve=new Decipher})});var fragmentedFor=function(n,t,e,r){var o=0,i=function(){return"function"==typeof t?t():t};i(),function c(t){for(var u=o+n,a=o;a<Math.min(u,i());a++)e(a);o+=n,o<i()?setTimeout(c,1):r()}()},log=function(n,t){var e=(t?"\r\n":"")+n;$("#log").append(e).delay(1),scrollDownLog()},output=function(n){$("#plaintext").html(n)},normalize=function(n){return $lText=n.toLowerCase(),$lText=$lText.replace(/[^a-z]/gi,""),$lText},scrollDownLog=function(n){$lElm=$("#log"),$lElm.scrollTop($lElm.prop("scrollHeight")-$lElm.height())},sortObjectByValue=function(n,t){var e=!!t,r=[];return $.each(n,function(n,t){r.push([n,t])}),r.sort(function(n,t){return e?t[1]-n[1]:n[1]-t[1]}),r};